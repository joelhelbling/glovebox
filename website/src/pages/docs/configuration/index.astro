---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import Prose from '../../../components/Prose.astro';
---

<DocsLayout
  title="Configuration"
  description="Profiles and environment variables"
  section="configuration"
  order={7}
>
  <Prose>
    <p>Glovebox configuration lives in YAML profile files and supports environment variable passthrough.</p>

    <h2>Profile Files</h2>

    <h3>Global Profile</h3>
    <p><strong>Location:</strong> <code>~/.glovebox/profile.yaml</code></p>
    <p>Defines your base development environment used across all projects.</p>
    <pre><code>version: 1
mods:
  - os/ubuntu
  - shells/zsh-ubuntu
  - editors/neovim
  - tools/mise
  - tools/homebrew
  - ai/claude-code
passthrough_env:
  - ANTHROPIC_API_KEY
  - GITHUB_TOKEN</code></pre>
    <p>Create with: <code>glovebox init --base</code></p>

    <h3>Project Profile</h3>
    <p><strong>Location:</strong> <code>.glovebox/profile.yaml</code> (in project directory)</p>
    <p>Defines project-specific extensions to the base image.</p>
    <pre><code>version: 1
mods:
  - languages/nodejs
  - tools/tmux
passthrough_env:
  - DATABASE_URL</code></pre>
    <p>Create with: <code>glovebox init</code></p>

    <h2>Profile Fields</h2>
    <table>
      <thead>
        <tr><th>Field</th><th>Description</th></tr>
      </thead>
      <tbody>
        <tr><td><code>version</code></td><td>Profile format version (currently <code>1</code>)</td></tr>
        <tr><td><code>mods</code></td><td>List of mod IDs to include</td></tr>
        <tr><td><code>passthrough_env</code></td><td>Environment variables to pass from host</td></tr>
      </tbody>
    </table>

    <h2>Environment Variable Passthrough</h2>
    <p>Glovebox can pass environment variables from your host to the container. This is essential for API keys, tokens, and other credentials.</p>

    <h3>Configuration</h3>
    <p>Add variables to <code>passthrough_env</code> in your profile:</p>
    <pre><code>passthrough_env:
  - ANTHROPIC_API_KEY
  - OPENAI_API_KEY
  - GITHUB_TOKEN
  - AWS_ACCESS_KEY_ID
  - AWS_SECRET_ACCESS_KEY</code></pre>

    <h3>Behavior</h3>
    <ul>
      <li>Variables from both global and project profiles are merged</li>
      <li>Only variables that are set in your host environment are passed through</li>
      <li>If a variable isn't set on the host, it's silently skipped</li>
    </ul>

    <h3>Visibility</h3>
    <p>When entering a container, Glovebox shows which variables are being passed:</p>
    <pre><code>  ┃ glovebox
  ┃
  ┃ Workspace   ~/projects/my-app
  ┃ Image       glovebox:my-app-abc1234
  ┃ Container   glovebox-my-app-abc1234 (new)
  ┃ Env         ANTHROPIC_API_KEY, GITHUB_TOKEN</code></pre>

    <h3>Security Note</h3>
    <p>Passthrough variables are visible inside the container. Anyone (or any code) with access to the container can read them. This is intentional—they're needed for tools to work—but be aware of what you're exposing.</p>

    <h2>File Locations</h2>

    <h3>Global (User) Files</h3>
    <table>
      <thead>
        <tr><th>Path</th><th>Purpose</th></tr>
      </thead>
      <tbody>
        <tr><td><code>~/.glovebox/profile.yaml</code></td><td>Global profile (base image definition)</td></tr>
        <tr><td><code>~/.glovebox/Dockerfile</code></td><td>Generated base Dockerfile</td></tr>
        <tr><td><code>~/.glovebox/mods/</code></td><td>Custom global mods</td></tr>
      </tbody>
    </table>

    <h3>Project Files</h3>
    <table>
      <thead>
        <tr><th>Path</th><th>Purpose</th></tr>
      </thead>
      <tbody>
        <tr><td><code>.glovebox/profile.yaml</code></td><td>Project profile (extends base)</td></tr>
        <tr><td><code>.glovebox/Dockerfile</code></td><td>Generated project Dockerfile</td></tr>
        <tr><td><code>.glovebox/mods/</code></td><td>Custom project mods</td></tr>
      </tbody>
    </table>

    <h3>Generated Dockerfiles</h3>
    <p>The <code>Dockerfile</code> in each location is generated by <code>glovebox build</code>. You can inspect it to understand what's being built, but don't edit it directly—changes will be overwritten.</p>
    <p>To customize the build, modify your profile or create custom mods.</p>

    <h2>Image and Container Naming</h2>

    <h3>Images</h3>
    <table>
      <thead>
        <tr><th>Type</th><th>Tag</th></tr>
      </thead>
      <tbody>
        <tr><td>Base</td><td><code>glovebox:base</code></td></tr>
        <tr><td>Project</td><td><code>glovebox:&lt;dirname&gt;-&lt;hash&gt;</code></td></tr>
      </tbody>
    </table>
    <p>The hash is derived from the absolute path to ensure uniqueness across projects with the same name.</p>

    <h3>Containers</h3>
    <table>
      <thead>
        <tr><th>Type</th><th>Name</th></tr>
      </thead>
      <tbody>
        <tr><td>Base (rare)</td><td><code>glovebox-base</code></td></tr>
        <tr><td>Project</td><td><code>glovebox-&lt;dirname&gt;-&lt;hash&gt;</code></td></tr>
      </tbody>
    </table>

    <h2>Example Configurations</h2>

    <h3>Minimal Base Profile</h3>
    <pre><code>version: 1
mods:
  - os/ubuntu
  - shells/bash
  - editors/vim</code></pre>

    <h3>Full-Featured Base Profile</h3>
    <pre><code>version: 1
mods:
  - os/ubuntu
  - shells/zsh-ubuntu
  - editors/neovim
  - tools/mise
  - tools/homebrew
  - tools/tmux
  - ai/claude-code
passthrough_env:
  - ANTHROPIC_API_KEY
  - OPENAI_API_KEY
  - GITHUB_TOKEN
  - GH_TOKEN</code></pre>

    <h3>Python Project Profile</h3>
    <pre><code>version: 1
mods:
  - languages/python
passthrough_env:
  - VIRTUAL_ENV
  - PYTHONPATH</code></pre>

    <h3>Node.js Project Profile</h3>
    <pre><code>version: 1
mods:
  - languages/nodejs
passthrough_env:
  - NODE_ENV
  - NPM_TOKEN</code></pre>
  </Prose>
</DocsLayout>
