name: homebrew
description: The Missing Package Manager for macOS (or Linux)
category: tool
install_phase: post_install
requires:
  - base

run_as_user: |
  # Install Homebrew to ~/.homebrew (inside home volume for persistence)
  if [ ! -d ~/.homebrew ]; then
    git clone https://github.com/Homebrew/brew ~/.homebrew
    # Install Homebrew's portable-ruby
    ~/.homebrew/bin/brew update --force
  fi

  # Configure Homebrew for bash
  touch ~/.bashrc
  echo 'eval "$(~/.homebrew/bin/brew shellenv)"' >> ~/.bashrc

  # Configure Homebrew for zsh (if zsh config dir exists)
  if [ -d ~/.config/zsh ] || [ -f ~/.zshrc ]; then
    touch ~/.zshrc
    echo 'eval "$(~/.homebrew/bin/brew shellenv)"' >> ~/.zshrc
  fi

  # Configure Homebrew for fish (if fish config dir exists)
  if [ -d ~/.config/fish ]; then
    mkdir -p ~/.config/fish/conf.d
    echo 'eval (~/.homebrew/bin/brew shellenv)' > ~/.config/fish/conf.d/homebrew.fish
  fi

env:
  HOMEBREW_PREFIX: /home/ubuntu/.homebrew
  HOMEBREW_CELLAR: /home/ubuntu/.homebrew/Cellar
  HOMEBREW_REPOSITORY: /home/ubuntu/.homebrew
  PATH: /home/ubuntu/.homebrew/bin:/home/ubuntu/.homebrew/sbin:$PATH
  MANPATH: /home/ubuntu/.homebrew/share/man
  INFOPATH: /home/ubuntu/.homebrew/share/info
